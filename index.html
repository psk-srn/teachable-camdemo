<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Teachable Machine - ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤/‡∏´‡∏•‡∏±‡∏á</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8.4/dist/teachablemachine-image.min.js"></script>
  <style>
    video { width: 224px; height: 224px; }
  </style>
</head>
<body>
  <h2>Teachable Machine: ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á</h2>

  <button onclick="switchCamera()">üîÑ ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
  <button onclick="start()">‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
  <br><br>

  <video id="video" autoplay muted playsinline></video>
  <div id="label-container"></div>

  <script>
    const MODEL_URL = "https://teachablemachine.withgoogle.com/models/4J75v0Ttn/";
    let model, video, labelContainer, maxPredictions;
    let currentFacingMode = "user"; // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤

    async function loadModel() {
      model = await tmImage.load(MODEL_URL + "model.json", MODEL_URL + "metadata.json");
      maxPredictions = model.getTotalClasses();
      labelContainer = document.getElementById("label-container");
      labelContainer.innerHTML = "";
      for (let i = 0; i < maxPredictions; i++) {
        labelContainer.appendChild(document.createElement("div"));
      }
    }

    async function startCamera() {
      if (video && video.srcObject) {
        video.srcObject.getTracks().forEach(track => track.stop());
      }

      const constraints = {
        audio: false,
        video: {
          facingMode: currentFacingMode // "user" ‡∏´‡∏£‡∏∑‡∏≠ "environment"
        }
      };

      const stream = await navigator.mediaDevices.getUserMedia(constraints);
      video.srcObject = stream;
      video.onloadedmetadata = () => {
        video.play();
        predictLoop(); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢
      };
    }

    async function predictLoop() {
      if (!model) return;
      const prediction = await model.predict(video);
      for (let i = 0; i < maxPredictions; i++) {
        const p = prediction[i];
        labelContainer.childNodes[i].innerText = `${p.className}: ${(p.probability * 100).toFixed(2)}%`;
      }
      requestAnimationFrame(predictLoop);
    }

    async function start() {
      await loadModel();
      await startCamera();
    }

    function switchCamera() {
      currentFacingMode = currentFacingMode === "user" ? "environment" : "user";
      startCamera(); // ‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢ mode ‡πÉ‡∏´‡∏°‡πà
    }

    // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° video tag
    video = document.getElementById("video");
  </script>
</body>
</html>
